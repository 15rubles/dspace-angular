<div class="container">
  <form (ngSubmit)="onSubmit()" [formGroup]="formModel">
    <div class="d-flex">
      <h2 class="flex-grow-1">{{ 'ldn-create-service.title' | translate }}</h2>
    </div>
    <!-- In the name section -->
    <div class="mb-5">
      <label for="name">{{ 'ldn-new-service.form.label.name' | translate }}</label>
      <input [class.invalid-field]="formModel.get('name').invalid && formModel.get('name').touched"
             [placeholder]="'ldn-new-service.form.placeholder.name' | translate" formControlName="name" id="name"
             name="name"
             type="text">
      <div *ngIf="formModel.get('name').invalid && formModel.get('name').touched" class="error-text">
        {{ 'ldn-new-service.form.error.name' | translate }}
      </div>
    </div>


    <!-- In the description section -->
    <div class="mb-5 mt-5 d-flex flex-column">
      <label for="description">{{ 'ldn-new-service.form.label.description' | translate }}</label>
      <textarea [placeholder]="'ldn-new-service.form.placeholder.description' | translate"
                formControlName="description" id="description" name="description"></textarea>
    </div>


    <!-- In the url section -->
    <div class="mb-5 mt-5">
      <label for="url">{{ 'ldn-new-service.form.label.url' | translate }}</label>
      <input [class.invalid-field]="formModel.get('url').invalid && formModel.get('url').touched"
             [placeholder]="'ldn-new-service.form.placeholder.url' | translate" formControlName="url" id="url"
             name="url"
             type="text">
      <div *ngIf="formModel.get('url').invalid && formModel.get('url').touched" class="error-text">
        {{ 'ldn-new-service.form.error.url' | translate }}
      </div>
    </div>


    <!-- In the ldnUrl section -->
    <div class="mb-5 mt-5">
      <label for="ldnUrl">{{ 'ldn-new-service.form.label.ldnUrl' | translate }}</label>
      <input [class.invalid-field]="formModel.get('ldnUrl').invalid && formModel.get('ldnUrl').touched"
             [placeholder]="'ldn-new-service.form.placeholder.ldnUrl' | translate" formControlName="ldnUrl"
             id="ldnUrl"
             name="ldnUrl"
             type="text">
      <div *ngIf="formModel.get('ldnUrl').invalid && formModel.get('ldnUrl').touched" class="error-text">
        {{ 'ldn-new-service.form.error.ldnurl' | translate }}
      </div>
    </div>
    <!-- In the score section -->
    <div class="mb-2">
      <label for="score">{{ 'ldn-new-service.form.label.score' | translate }}</label>
      <input [class.invalid-field]="formModel.get('score').invalid && formModel.get('score').touched"
             [placeholder]="'ldn-new-service.form.placeholder.score' | translate" formControlName="score"
             id="score"
             name="score"
             type="text">
      <div *ngIf="formModel.get('score').invalid && formModel.get('score').touched" class="error-text">
        {{ 'ldn-new-service.form.error.score' | translate }}
      </div>
    </div>

    <!-- In the Inbound Patterns section -->
    <div class="row mb-2 mt-5">
      <div class="col">
        <label>{{ 'ldn-new-service.form.label.inboundPattern' | translate }} </label>
      </div>
      <div class="col">
        <label class="label-box">{{ 'ldn-new-service.form.label.ItemFilter' | translate }}</label>
      </div>
      <div class="col-sm1 ">
        <label class="label-box-2">{{ 'ldn-new-service.form.label.automatic' | translate }}</label>
      </div>
      <div class="col-sm-2">
      </div>
    </div>

    <div *ngFor="let patternGroup of formModel.get('notifyServiceInboundPatterns')['controls']; let i = index"
         formGroupName="notifyServiceInboundPatterns">

      <ng-container [formGroupName]="i">


        <div class="row mb-1">
          <div class="col">
            <select #inboundPattern formControlName="pattern" id="additionalInboundPattern{{i}}"
                    name="additionalInboundPattern{{i}}" required>
              <option value="">{{ 'ldn-new-service.form.label.placeholder.inboundPattern' | translate }}</option>
              <option *ngFor="let pattern of inboundPatterns"
                      [value]="pattern">{{ 'ldn-service.form.pattern.' + pattern + '.label' | translate }} </option>
            </select>
            <div *ngIf="!patternSelected()" class="error-text">
              {{ 'ldn-new-service.form.error.patterns' | translate }}
            </div>
          </div>


          <div class="col">
            <ng-container *ngIf="inboundPattern.value">
              <select formControlName="constraint" id="constraint{{i}}" name="constraint{{i}}">
                <option value="">{{ 'ldn-new-service.form.label.placeholder.selectedItemFilter' | translate }}</option>
                <option *ngFor="let itemFilter of (itemfiltersRD$ | async)?.payload?.page"
                        [value]="itemFilter.id">{{ itemFilter.id }}</option>
              </select>
            </ng-container>
          </div>

          <div [style.visibility]="inboundPattern.value ? 'visible' : 'hidden'" class="col-sm-1">
            <input formControlName="automatic" hidden id="automatic{{i}}" name="automatic{{i}}"
                   type="checkbox">
            <div (click)="toggleAutomatic(i)"
                 [class.checked]="formModel.get('notifyServiceInboundPatterns.' + i + '.automatic').value"
                 class="toggle-switch">
              <div class="slider"></div>
            </div>
          </div>

          <div class="col-sm-1">
            <button (click)="removeInboundPattern(i)" class="btn btn-outline-dark trash-button">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </ng-container>
    </div>

    <span (click)="addInboundPattern()"
          class="add-pattern-link mb-4">{{ 'ldn-new-service.form.label.addPattern' | translate }}</span>

    <!-- In the Outbound Patterns section -->
    <div class="row mb-1 mt-5">
      <div class="col">
        <label>{{ 'ldn-new-service.form.label.outboundPattern' | translate }} </label>
      </div>
      <div class="col">
        <label class="label-box">{{ 'ldn-new-service.form.label.ItemFilter' | translate }}</label>
      </div>
      <div class="col-sm1 ">
        <label class="label-box-2" style="visibility: hidden;">
          {{ 'ldn-new-service.form.label.automatic' | translate }}
        </label>
      </div>
      <div class="col-sm-2">
      </div>
    </div>

    <div *ngFor="let patternGroup of formModel.get('notifyServiceOutboundPatterns')['controls']; let i = index"
         formGroupName="notifyServiceOutboundPatterns">

      <ng-container [formGroupName]="i">

        <!-- Input elements in a separate row -->
        <div class="row mb-1">
          <div class="col">
            <select #outboundPattern formControlName="pattern" id="additionalOutboundPattern{{i}}"
                    name="additionalOutboundPattern{{i}}"
                    required>
              <option value="">{{ 'ldn-new-service.form.label.placeholder.outboundPattern' | translate }}</option>
              <option *ngFor="let pattern of outboundPatterns"
                      [value]="pattern">{{ 'ldn-service.form.pattern.' + pattern + '.label' | translate }}</option>
            </select>
            <div *ngIf="!patternSelected()" class="error-text">
              {{ 'ldn-new-service.form.error.patterns' | translate }}
            </div>
          </div>
          <div class="col">
            <ng-container *ngIf="outboundPattern.value">
              <select formControlName="constraint" id="constraint{{i}}" name="constraint{{i}}">
                <option value="">{{ 'ldn-new-service.form.label.placeholder.selectedItemFilter' | translate }}</option>
                <option *ngFor="let itemFilter of (itemfiltersRD$ | async)?.payload?.page"
                        [value]="itemFilter.id">{{ itemFilter.id }}</option>
              </select>
            </ng-container>
          </div>

          <div [style.visibility]="'hidden'" class="col-sm1">
            <input hidden id="automatic{{i}}" name="automatic{{i}}" type="checkbox">
            <div
              class="toggle-switch">
              <div class="slider"></div>
            </div>
          </div>

          <div class="col-sm-1">
            <button (click)="removeOutboundPattern(i)" class="btn btn-outline-dark trash-button">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </ng-container>

    </div>

    <span (click)="addOutboundPattern()"
          class="add-pattern-link mb-4">{{ 'ldn-new-service.form.label.addPattern' | translate }}
    </span>

    <div aria-label="Basic example" class="submission-form-footer mt-1 mb-1 position-sticky" role="group">
      <button class="btn btn-primary" type="submit">
        <span><i class="fas fa-save"></i> {{ 'ldn-new-service.form.label.submit' | translate }}</span>
      </button>
      <div class="d-flex">
        <button (click)="this.openResetFormModal(this.resetFormModal)" class="btn btn-danger" type="button">
          <span><i class="fas fa-trash"></i> {{ 'submission.general.discard.submit' | translate }}</span>
        </button>
      </div>
    </div>
  </form>
</div>
<ng-template #confirmModal>

  <div>

    <div class="modal-header">
      <div>
        <h4>{{'service.overview.create.modal' | translate }}</h4>
      </div>
      <button (click)="closeModal()" aria-label="Close"
              class="close" type="button">
        <span aria-hidden="true">Ã—</span>
      </button>
    </div>

    <div class="modal-body">
      <div>
        {{ 'service.create.body' | translate }}
      </div>
      <div class="mt-4">
        <button (click)="closeModal()" class="btn btn-danger"
                id="delete-confirm">{{ 'service.refuse.create' | translate }}
        </button>
        <button (click)="createService()"
                class="btn btn-primary mr-2 custom-btn">{{ 'service.confirm.create' | translate }}
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #resetFormModal>

  <div>

    <div class="modal-header">
      <div>
        <h4>{{'service.create.reset-form.modal' | translate }}</h4>
      </div>
      <button (click)="closeModal()" aria-label="Close"
              class="close" type="button">
        <span aria-hidden="true">Ã—</span>
      </button>
    </div>

    <div class="modal-body">
      <div>
        {{ 'service.create.reset-form.body' | translate }}
      </div>
      <div class="mt-4">
        <button (click)="resetFormAndLeave()"
                class="btn btn-primary mr-2 custom-btn"
                id="reset-confirm">{{ 'service.overview.reset-form.reset-return' | translate }}
        </button>
        <button (click)="closeModal()" class="btn btn-danger"
                id="reset-delete">{{ 'service.overview.reset-form.reset-confirm' | translate }}
        </button>
      </div>
    </div>
  </div>
</ng-template>


